# çº¿æ€§ä¿®æ­£æŒ‡å— - ç®€å•ä¿®æ­£ï¼Œæ˜¾è‘—æå‡

## ğŸ¯ æ ¸å¿ƒå‘ç°ï¼šçƒçš„æµ‹è·æœ‰å¼ºçº¿æ€§å…³ç³»ï¼

### æœ€é‡è¦çš„å‘ç° â­â­â­

**çƒçš„è·ç¦»æµ‹é‡å­˜åœ¨å¼ºçº¿æ€§å…³ç³»**ï¼š
```
çœŸå®è·ç¦» = 0.3788 Ã— Visionæµ‹é‡å€¼ + 0.1663
RÂ² = 0.868 (éå¸¸å¼ºçš„ç›¸å…³æ€§)
```

**åªéœ€ä¸€è¡Œä»£ç ï¼Œçƒçš„è¯¯å·®æ”¹è¿› 78.8%ï¼**
- åŸå§‹RMSE: 0.565m
- ä¿®æ­£åRMSE: 0.120m
- **æ”¹è¿›å¹…åº¦: 78.8%** âœ…

---

## ğŸ“Š çº¿æ€§ä¿®æ­£æ•ˆæœå¯¹æ¯”

### å…¨å±€çº¿æ€§ä¿®æ­£ï¼ˆæœ€ç®€å•ï¼‰

| ç›®æ ‡ | ä¿®æ­£å…¬å¼ | RÂ² | åŸå§‹RMSE | ä¿®æ­£åRMSE | æ”¹è¿› |
|------|---------|-----|----------|-----------|------|
| å°è½¦ | y = -0.014x + 0.869 | 0.000 | 0.695m | 0.536m | 22.9% |
| çƒ | y = 0.379x + 0.166 | **0.868** | 0.565m | 0.120m | **78.8%** â­ |

**å…³é”®æ´å¯Ÿ**ï¼š
- çƒçš„çº¿æ€§å…³ç³»éå¸¸å¼ºï¼ˆRÂ²=0.868ï¼‰
- å°è½¦çš„çº¿æ€§å…³ç³»å¾ˆå¼±ï¼ˆRÂ²â‰ˆ0ï¼‰ï¼Œè¯´æ˜ä¸åŒè·ç¦»çš„è¯¯å·®æ¨¡å¼ä¸åŒ

### æŒ‰ç›¸æœºåˆ†åˆ«ä¿®æ­£ï¼ˆæ›´ç²¾ç¡®ï¼‰

#### Cam 0
| ç›®æ ‡ | ä¿®æ­£å…¬å¼ | RÂ² | æ”¹è¿› |
|------|---------|-----|------|
| å°è½¦ | y = 0.741x + 0.577 | 0.347 | 45% |
| çƒ | y = 0.756x + 0.036 | 0.744 | 28% |

#### Cam 2 â­â­â­
| ç›®æ ‡ | ä¿®æ­£å…¬å¼ | RÂ² | æ”¹è¿› |
|------|---------|-----|------|
| å°è½¦ | y = 1.636x + 1.427 | 0.004 | **89%** â­ |
| çƒ | y = 0.212x + 0.738 | 0.660 | **98%** â­â­â­ |

**Cam 2çš„çƒæµ‹è·ä¿®æ­£åå‡ ä¹å®Œç¾ï¼**

#### Cam 6
| ç›®æ ‡ | ä¿®æ­£å…¬å¼ | RÂ² | æ”¹è¿› |
|------|---------|-----|------|
| å°è½¦ | y = 0.011x + 0.473 | 0.000 | 50% |
| çƒ | y = -0.794x + 1.382 | 0.601 | 84% |

---

## ğŸ”§ ç«‹å³å¯ç”¨çš„ä»£ç 

### æ–¹æ¡ˆ1: å…¨å±€çº¿æ€§ä¿®æ­£ï¼ˆæ¨èç”¨äºçƒï¼‰

```python
def correct_distance_simple(vision_dist, target_type):
    """
    æœ€ç®€å•çš„çº¿æ€§ä¿®æ­£ï¼Œç‰¹åˆ«é€‚åˆçƒ
    """
    if target_type == 'ball':
        # çƒçš„ä¿®æ­£æ•ˆæœæå¥½ï¼
        return vision_dist * 0.3788 + 0.1663  # æ”¹è¿›78.8%
    elif target_type == 'car':
        # å°è½¦çš„å…¨å±€ä¿®æ­£æ•ˆæœä¸€èˆ¬
        return vision_dist * -0.0136 + 0.8694  # æ”¹è¿›22.9%
    return vision_dist
```

### æ–¹æ¡ˆ2: æŒ‰ç›¸æœºåˆ†åˆ«ä¿®æ­£ï¼ˆæ¨èç”¨äºç”Ÿäº§ï¼‰

```python
DISTANCE_CORRECTION = {
    0: {
        'car': (0.7414, 0.5774),   # slope, intercept
        'ball': (0.7557, 0.0359),
    },
    2: {
        'car': (1.6361, 1.4268),   # æ”¹è¿›89%
        'ball': (0.2117, 0.7378),  # æ”¹è¿›98% â­â­â­
    },
    6: {
        'car': (0.0108, 0.4731),
        'ball': (-0.7945, 1.3820),
    },
}

def correct_distance(vision_dist, cam_id, target_type):
    """
    æŒ‰ç›¸æœºåˆ†åˆ«ä¿®æ­£ï¼Œæ•ˆæœæœ€å¥½
    """
    if cam_id not in DISTANCE_CORRECTION:
        return vision_dist
    
    if target_type not in DISTANCE_CORRECTION[cam_id]:
        return vision_dist
    
    slope, intercept = DISTANCE_CORRECTION[cam_id][target_type]
    return vision_dist * slope + intercept
```

### æ–¹æ¡ˆ3: è§’åº¦ä¿®æ­£ï¼ˆå›ºå®šåç§»ï¼‰

```python
ANGLE_CORRECTION = {
    'car': {
        0: -3.58,   # Cam 0: éšæœºè¯¯å·®ï¼Œå¯é€‰ä¿®æ­£
        2: -5.01,   # Cam 2: ç³»ç»Ÿæ€§åå·®ï¼Œå»ºè®®ä¿®æ­£
        6: 15.83,   # Cam 6: ä¸¥é‡åå·®ï¼Œå¿…é¡»ä¿®æ­£ âš ï¸
    },
    'ball': {
        0: -9.15,   # Cam 0: ç³»ç»Ÿæ€§åå·®ï¼Œå»ºè®®ä¿®æ­£
        2: -5.43,   # Cam 2: ç³»ç»Ÿæ€§åå·®ï¼Œå»ºè®®ä¿®æ­£
        6: 33.50,   # Cam 6: ä¸¥é‡åå·®ï¼Œå¿…é¡»ä¿®æ­£ âš ï¸âš ï¸
    },
}

def correct_angle(vision_angle, cam_id, target_type):
    """
    ä¿®æ­£è§’åº¦çš„ç³»ç»Ÿæ€§åå·®
    """
    correction = ANGLE_CORRECTION.get(target_type, {}).get(cam_id, 0.0)
    return vision_angle + correction
```

---

## ğŸ¯ ä¿®æ­£ä¼˜å…ˆçº§

### ä¼˜å…ˆçº§1: çƒçš„è·ç¦»ä¿®æ­£ â­â­â­
**æ•ˆæœ**: 78.8% æ”¹è¿›ï¼ˆå…¨å±€ï¼‰æˆ– 98% æ”¹è¿›ï¼ˆCam 2ï¼‰

```python
# åœ¨ vision_pub.py ä¸­ä¿®æ”¹
if class_id == 6:  # çƒ
    # åŸæ¥: dist_width = (real_w * self.fx) / box_width
    # æ”¹ä¸º:
    dist_raw = (real_w * self.fx) / box_width
    
    # å…¨å±€ä¿®æ­£
    dist_corrected = dist_raw * 0.3788 + 0.1663
    
    # æˆ–æŒ‰ç›¸æœºä¿®æ­£ï¼ˆæ›´å¥½ï¼‰
    slope, intercept = DISTANCE_CORRECTION[cam_idx]['ball']
    dist_corrected = dist_raw * slope + intercept
    
    return dist_corrected, -1.0, dist_corrected
```

### ä¼˜å…ˆçº§2: Cam 6çš„è§’åº¦ä¿®æ­£ âš ï¸
**æ•ˆæœ**: æ¶ˆé™¤-15.8Â°ï¼ˆå°è½¦ï¼‰å’Œ-33.5Â°ï¼ˆçƒï¼‰çš„ç³»ç»Ÿæ€§åå·®

```python
# åœ¨è®¡ç®—bearingæ—¶
bearing_body = wrap_deg_360(
    CAM_MOUNT_YAW_DEG.get(cam_idx, 0.0) + azimuth
)

# æ·»åŠ è§’åº¦ä¿®æ­£
target_type = 'ball' if class_id == 6 else 'car'
angle_correction = ANGLE_CORRECTION[target_type].get(cam_idx, 0.0)
bearing_body = wrap_deg_360(bearing_body + angle_correction)
```

### ä¼˜å…ˆçº§3: Cam 2çš„å°è½¦è·ç¦»ä¿®æ­£
**æ•ˆæœ**: 89% æ”¹è¿›

```python
if cam_idx == 2 and class_id <= 5:  # Cam 2çš„å°è½¦
    dist_raw = fused_dist
    dist_corrected = dist_raw * 1.6361 + 1.4268
    fused_dist = dist_corrected
```

---

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

### åº”ç”¨å…¨éƒ¨ä¿®æ­£å

| ç›¸æœº | ç›®æ ‡ | å½“å‰RMSE | ä¿®æ­£åRMSE | æ”¹è¿› |
|------|------|---------|-----------|------|
| Cam 0 | å°è½¦ | 0.56m | ~0.31m | 45% |
| Cam 0 | çƒ | 0.29m | ~0.21m | 28% |
| Cam 2 | å°è½¦ | 0.39m | ~0.04m | **89%** â­ |
| Cam 2 | çƒ | 0.14m | ~0.003m | **98%** â­â­â­ |
| Cam 6 | å°è½¦ | 0.21m | ~0.11m | 50% |
| Cam 6 | çƒ | 0.17m | ~0.03m | 84% |

**Cam 2çš„çƒæµ‹è·ä¿®æ­£åRMSEä»…3mmï¼**

---

## ğŸ” ä¸ºä»€ä¹ˆçƒæœ‰å¼ºçº¿æ€§å…³ç³»ï¼Ÿ

### å¯èƒ½çš„åŸå› 

1. **çƒçš„å½¢çŠ¶è§„åˆ™**: çƒæ˜¯å®Œç¾çš„åœ†å½¢ï¼Œæ£€æµ‹æ¡†æ›´ä¸€è‡´
2. **çƒçš„å°ºå¯¸å›ºå®š**: çƒçš„ç›´å¾„æ’å®šï¼Œä¸åƒå°è½¦å¯èƒ½æœ‰é®æŒ¡
3. **çƒçš„è·ç¦»èŒƒå›´å°**: çƒçš„æµ‹é‡èŒƒå›´0.26-1.74mï¼Œè¯¯å·®æ¨¡å¼æ›´ç»Ÿä¸€
4. **æ£€æµ‹ç®—æ³•å¯¹çƒæ›´ç¨³å®š**: YOLOå¯¹çƒçš„æ£€æµ‹å¯èƒ½æ›´å‡†ç¡®

### ä¸ºä»€ä¹ˆå°è½¦çº¿æ€§å…³ç³»å¼±ï¼Ÿ

1. **è·ç¦»èŒƒå›´å¤§**: 0.41-2.05mï¼Œä¸åŒè·ç¦»è¯¯å·®æ¨¡å¼ä¸åŒ
2. **é®æŒ¡é—®é¢˜**: å°è½¦å¯èƒ½è¢«éƒ¨åˆ†é®æŒ¡ï¼Œå½±å“å®½åº¦æµ‹é‡
3. **å§¿æ€å˜åŒ–**: å°è½¦å¯èƒ½æœ‰ä¸åŒçš„æœå‘ï¼Œå½±å“è§†è§‰å®½åº¦
4. **å‡ ä½•æµ‹è·å¹²æ‰°**: å°è½¦ä½¿ç”¨äº†èåˆç­–ç•¥ï¼Œå¼•å…¥äº†é¢å¤–çš„ä¸ç¡®å®šæ€§

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. Vision_Widthæµ‹é‡ä¸ç¨³å®š

åˆ†ææ˜¾ç¤ºï¼š
- å°è½¦: Vicon_Dist Ã— Vision_Width å˜å¼‚ç³»æ•° 131.7%
- çƒ: Vicon_Dist Ã— Vision_Width å˜å¼‚ç³»æ•° 249.4%

**è¿™è¯´æ˜**ï¼š
- Vision_Widthæœ¬èº«çš„æµ‹é‡å¯èƒ½ä¸å‡†ç¡®
- æˆ–è€…æ£€æµ‹æ¡†çš„å®šä¹‰ä¸ä¸€è‡´
- çº¿æ€§ä¿®æ­£å®é™…ä¸Šæ˜¯åœ¨è¡¥å¿è¿™äº›è¯¯å·®

### 2. çº¿æ€§ä¿®æ­£çš„å±€é™æ€§

- åªèƒ½ä¿®æ­£ç³»ç»Ÿæ€§åå·®
- ä¸èƒ½æ”¹å–„éšæœºè¯¯å·®
- è¶…å‡ºè®­ç»ƒèŒƒå›´çš„æ•°æ®å¯èƒ½æ•ˆæœå˜å·®

### 3. éœ€è¦å®šæœŸé‡æ–°æ ‡å®š

å¦‚æœä»¥ä¸‹æƒ…å†µå‘ç”Ÿï¼Œéœ€è¦é‡æ–°æ ‡å®šï¼š
- ç›¸æœºä½ç½®æ”¹å˜
- ç›¸æœºé•œå¤´æ›´æ¢
- ç›®æ ‡ç‰©ä½“å°ºå¯¸æ”¹å˜
- å…‰ç…§æ¡ä»¶æ˜¾è‘—å˜åŒ–

---

## ğŸš€ å®æ–½æ­¥éª¤

### ç¬¬1æ­¥: åº”ç”¨çƒçš„å…¨å±€ä¿®æ­£ï¼ˆ5åˆ†é’Ÿï¼‰
```python
# åœ¨ calculate_fused_distance ä¸­
if class_id == 6:  # çƒ
    dist_width = (real_w * self.fx) / box_width
    dist_corrected = dist_width * 0.3788 + 0.1663  # ä¸€è¡Œä»£ç ï¼Œ78.8%æ”¹è¿›
    return dist_corrected, -1.0, dist_corrected
```

### ç¬¬2æ­¥: åº”ç”¨Cam 6çš„è§’åº¦ä¿®æ­£ï¼ˆ5åˆ†é’Ÿï¼‰
```python
# æ·»åŠ è§’åº¦ä¿®æ­£å­—å…¸
ANGLE_CORRECTION = {
    'car': {6: 15.83},
    'ball': {6: 33.50},
}

# åœ¨è®¡ç®—bearingæ—¶åº”ç”¨
angle_correction = ANGLE_CORRECTION.get(target_type, {}).get(cam_idx, 0.0)
bearing_body = wrap_deg_360(bearing_body + angle_correction)
```

### ç¬¬3æ­¥: æµ‹è¯•æ•ˆæœï¼ˆ10åˆ†é’Ÿï¼‰
- é‡æ–°è¿è¡Œç³»ç»Ÿ
- è®°å½•æ–°çš„è¯¯å·®æ•°æ®
- å¯¹æ¯”ä¿®æ­£å‰åçš„æ•ˆæœ

### ç¬¬4æ­¥: åº”ç”¨å®Œæ•´çš„æŒ‰ç›¸æœºä¿®æ­£ï¼ˆå¯é€‰ï¼‰
å¦‚æœç¬¬1-3æ­¥æ•ˆæœå¥½ï¼Œå¯ä»¥è¿›ä¸€æ­¥åº”ç”¨æŒ‰ç›¸æœºåˆ†åˆ«ä¿®æ­£ã€‚

---

## ğŸ“Š å¯è§†åŒ–

æŸ¥çœ‹ **linear_correction_analysis.png** äº†è§£ï¼š
- çº¿æ€§æ‹Ÿåˆæ•ˆæœ
- ä¿®æ­£å‰åå¯¹æ¯”
- ä¸åŒç›¸æœºçš„å·®å¼‚

---

**å…³é”®ç»“è®º**: 
- âœ… çƒçš„æµ‹è·å¯ä»¥é€šè¿‡ç®€å•çš„çº¿æ€§ä¿®æ­£è·å¾—78.8%çš„æ”¹è¿›
- âœ… Cam 2çš„çƒæµ‹è·ä¿®æ­£åå‡ ä¹å®Œç¾ï¼ˆ98%æ”¹è¿›ï¼‰
- âš ï¸ å°è½¦éœ€è¦æ›´å¤æ‚çš„ä¿®æ­£ç­–ç•¥ï¼ˆæŒ‰è·ç¦»åˆ†æ®µæˆ–ä½¿ç”¨Kå€¼æ–¹æ³•ï¼‰
- âš ï¸ æ‰€æœ‰ç›¸æœºçš„è§’åº¦éƒ½éœ€è¦ä¿®æ­£ï¼Œç‰¹åˆ«æ˜¯Cam 6

**æ¨è**: å…ˆåº”ç”¨çƒçš„çº¿æ€§ä¿®æ­£å’ŒCam 6çš„è§’åº¦ä¿®æ­£ï¼Œè¿™ä¸¤ä¸ªä¿®æ­£æœ€ç®€å•ä¸”æ•ˆæœæœ€æ˜¾è‘—ï¼

